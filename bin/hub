#!/bin/bash
verbose=""
function common {
    comm -12 <(find $1 -maxdepth 1 | xargs basename | sort ) <(find $2 -maxdepth 1| xargs basename | sort)
}

function pull {
    echo "hub -p(ull) will be deprecated in favor of repos"
    for i in `\ls -d */` ;
    do 
      cd ${i}
      git stash
      git checkout master;
      git pull;
      git checkout -
      git stash pop
      cd - > /dev/null
    done
}

function branches {
    for i in `ls -d */` ;
    do 
      cd ${i} ; 
      branches=$(git branch | wc -l)
      if [ ${branches} -gt 1 ] 
      then
        echo ${i}; 
        git branch ${verbose}
      fi
      cd - > /dev/null; 
    done
}

function status {
    for i in `ls -d */`;
    do
        cd ${i}
        modified=$(git status -s | wc -l)
        if [ ${modified} -gt 0 ]
        then
            echo ${i}
            git status -s
        fi
        cd - > /dev/null;
   done     
}

function list_stash {
    for i in `ls -d */`;
    do
        cd ${i}
        modified=$(git --no-pager stash list | wc -l)
        if [ ${modified} -gt 0 ]
        then
            echo ${i}
            git --no-pager stash list
        fi
        cd - > /dev/null;
   done
}
op=exit
while getopts ":bslvc" opt;
do
    case ${opt} in
        v)
            verbose=" -v"
        ;;
        c)
            shift
            op=common
            params=$@
        ;;
        b)
            op=branches
        ;;
        s)
            op=status
        ;;    
        l)
            op=list_stash
        ;;
        \?)
            echo "Invalid option"
            op=exit
        ;;
    esac    
done
eval ${op} ${params}
